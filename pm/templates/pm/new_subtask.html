{% extends 'pm/base.html' %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'project_list' %}">projects</a> &gt;
    <a href="{% url 'project_detail' project=project %}">{{ project_title }}</a>{% if epic %} &gt;
    <a href="{% url 'epic_detail' project=project epic=epic %}">{{ epic_title }}</a>{% endif %} &gt;
    {% if epic %}
    <a href="{% url 'task_detail' project=project epic=epic task=task %}">{{ task_title }}</a>
    {% else %}
    <a href="{% url 'task_detail_no_epic' project=project task=task %}">{{ task_title }}</a>
    {% endif %} &gt;
    new subtask
</div>

<div class="page-title">New Subtask</div>

<div class="section">
    <form method="post">
        {% csrf_token %}

        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" name="title" id="title" required autofocus>
        </div>

        <div class="form-group status-reason-form">
            <label for="status">Status</label>
            <select name="status" id="status" class="status-reason-select">
                {% for status in all_statuses %}
                <option value="{{ status.name }}" data-requires-reason="{% if status.pending_reason %}1{% else %}0{% endif %}">{{ status.display_name }}</option>
                {% endfor %}
            </select>
            <input type="text" name="pending_reason" class="pending-reason-input" placeholder="Reason..." style="display: none; margin-top: 6px;">
        </div>

        <div class="form-group">
            <label for="priority">Priority</label>
            <select name="priority" id="priority">
                <option value="">None</option>
                <option value="1">1 (Highest)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Lowest)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="due_date">Due Date/Time</label>
            <input type="datetime-local" name="due_date" id="due_date">
        </div>

        <div class="form-group">
            <label for="labels">Labels (comma-separated)</label>
            <input type="text" name="labels" id="labels" placeholder="frontend, api, bug">
        </div>

        <div class="form-group">
            <label for="content">Description (markdown)</label>
            <textarea name="content" id="content"></textarea>
        </div>

        <div class="form-actions">
            <button type="submit">Create Subtask</button>
            {% if epic %}
            <a href="{% url 'task_detail' project=project epic=epic task=task %}" class="button button-secondary">Cancel</a>
            {% else %}
            <a href="{% url 'task_detail_no_epic' project=project task=task %}" class="button button-secondary">Cancel</a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}
