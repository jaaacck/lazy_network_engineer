{% extends "pm/base.html" %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'project_list' %}">projects</a> &gt; today
</div>

<div class="page-title">Today</div>

<div class="section">
    <div class="section-title">Due Today</div>
    {% if today_items %}
    <div class="item-list">
        {% for item in today_items %}
        <div class="item">
            <div class="item-title">
                {% if item.type == 'task' %}
                {% if item.epic_id %}
                <a href="{% url 'task_detail' project=item.project_id epic=item.epic_id task=item.id %}">{{ item.title }}</a>
                {% else %}
                <a href="{% url 'task_detail_no_epic' project=item.project_id task=item.id %}">{{ item.title }}</a>
                {% endif %}
                {% else %}
                {% if item.epic_id %}
                <a href="{% url 'subtask_detail' project=item.project_id epic=item.epic_id task=item.task_id subtask=item.id %}">{{ item.title }}</a>
                {% else %}
                <a href="{% url 'subtask_detail_no_epic' project=item.project_id task=item.task_id subtask=item.id %}">{{ item.title }}</a>
                {% endif %}
                {% endif %}
                <span class="badge badge-status status-{{ item.status }}">{{ item.status_display|default:item.status }}</span>
                {% if item.priority %}<span class="badge badge-priority priority-{{ item.priority }}">P{{ item.priority }}</span>{% endif %}
            </div>
            <div class="item-meta">Due: {{ item.due_date }}</div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">No items due today.</div>
    {% endif %}
</div>

<div class="section">
    <div class="section-title">Backlog</div>
    {% if backlog %}
    <div class="item-list">
        {% for item in backlog %}
        <div class="item">
            <div class="item-title">
                {% if item.type == 'task' %}
                {% if item.epic_id %}
                <a href="{% url 'task_detail' project=item.project_id epic=item.epic_id task=item.id %}">{{ item.title }}</a>
                {% else %}
                <a href="{% url 'task_detail_no_epic' project=item.project_id task=item.id %}">{{ item.title }}</a>
                {% endif %}
                {% else %}
                {% if item.epic_id %}
                <a href="{% url 'subtask_detail' project=item.project_id epic=item.epic_id task=item.task_id subtask=item.id %}">{{ item.title }}</a>
                {% else %}
                <a href="{% url 'subtask_detail_no_epic' project=item.project_id task=item.task_id subtask=item.id %}">{{ item.title }}</a>
                {% endif %}
                {% endif %}
                <span class="badge badge-status status-{{ item.status }}">{{ item.status_display|default:item.status }}</span>
                {% if item.priority %}<span class="badge badge-priority priority-{{ item.priority }}">P{{ item.priority }}</span>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty">Backlog is empty.</div>
    {% endif %}
</div>
{% endblock %}
